# Google Learn Portal (クイズシステム V2)

Google Apps Script (GAS) を活用した、高機能なクイズ作成・分析・管理システムです。  
スプレッドシートで問題を管理し、Google フォームを自動生成できるほか、回答データの詳細な分析ダッシュボードや、ポータルサイトへの連携機能も備えています。

## 🚀 主な機能

### 1. Google フォーム自動生成 (`FormBuilder.gs`)
- **一括生成**: スプレッドシートの「Master」シートに入力したデータから、Google フォームを自動的に作成・更新します。
- **リッチコンテンツ**: 問題画像、解説文、解説画像、参考リンクを自動設定できます。
- **完了画面カスタマイズ**: 回答後の画面に、分析ダッシュボードやポータルへのリンクを自動埋め込みします。

### 2. 分析ダッシュボード (`WebApp.gs`, `index.html`)
- **Webアプリ化**: GASをウェブアプリとしてデプロイすることで、リッチな分析画面を提供します。
- **リアルタイム集計**:
  - 全体の平均点、合格率
  - ユーザーごとの成績一覧
  - 問題ごとの正答率・識別指数 (DI値)
- **良問・難問抽出**: 統計データに基づき、「良問」や「難問」を自動ピックアップして表示します。

### 3. 自動採点・集計エンジン (`DataAggregator.gs`)
- **自動採点**: フォームの回答を自動で採点し、スコアを算出します。
- **重複管理**: 同一ニックネームでの複数回回答時に、日時を付与して別データとして管理します。
- **統計データ生成**: 問題ごとの正答率や、合格・不合格者ごとの回答傾向を分析します。

### 4. ポータル連携 (`HubConnector.gs`)
- **ディレクトリ登録**: 作成したクイズを、組織内の「ポータルサイト」（ディレクトリ管理用スプレッドシート）へワンクリックで登録・公開できます。

## 🛠 セットアップ手順

### 1. スプレッドシートの準備
新規スプレッドシートを作成し、以下のシートを用意してください（名前は正確に一致させる必要があります）。

| シート名 | 用途 |
| --- | --- |
| **Master** | 問題データ入力用（A列:ID, B:問題文, C:画像URL, D-H:選択肢, I:正解番号, ...） |
| **Config** | システム設定用（Form_ID, Portal_Url 等を管理） |
| **Analysis_Users** | （自動出力）ユーザーごとの分析結果書き出し先 |
| **Analysis_Questions** | （自動出力）問題ごとの分析結果書き出し先 |

※ 初回実行時に `Config` シートがない場合、エラーになる可能性があります。A列にキー、B列に値を設定する形式です。

### 2. スクリプトのデプロイ
1. このプロジェクトのスクリプトエディタを開きます。
2. 右上の「デプロイ」>「新しいデプロイ」を選択。
3. 種類: 「ウェブアプリ」を選択。
4. アクセスできるユーザー: 用途に合わせて設定（通常は「全員」または「ドメイン内のユーザー」）。
5. 発行されたURLをコピーし、`Config` シートの `Dashboard_Url` に設定しておくと連携がスムーズです。

### 3. 初回実行
1. スプレッドシートをリロードすると、メニューバーに **「⚡️クイズシステムV2」** が表示されます。
2. **「⚡️クイズシステムV2」 > 「⚠️ 設定リセット」** を実行して初期化します。
3. Masterシートに問題データを入力します。
4. **「⚡️クイズシステムV2」 > 「フォーム生成・更新 (実行)」** をクリックしてフォームを作成します。

## 📝 使い方

### 問題の追加・更新
1. `Master` シートに問題を追加・修正します。
2. メニューから **「フォーム生成・更新 (実行)」** を実行すると、フォームの内容が同期されます。

### 集計の実行
1. ユーザーがフォームに回答すると、`Form Responses 1` シートにデータが溜まります。
2. 通常は回答時に自動トリガー等で集計されますが、手動で行う場合はメニューから **「🔄 集計データを更新」** を実行してください。
3. `Analysis_Users` 等のシートが更新され、ダッシュボードにも反映されます。

### ダッシュボードの閲覧
- デプロイしたウェブアプリのURLにアクセスすると、分析結果がグラフや表で表示されます。

## 📂 ファイル構成

- **WebApp.gs**: 分析ダッシュボードのバックエンド処理 (doGet)。
- **index.html**: ダッシュボードのフロントエンド (HTML/CSS/JS)。
- **FormBuilder.gs**: Google フォーム生成・更新ロジック。
- **DataAggregator.gs**: 回答データの採点・集計ロジック。
- **HubConnector.gs**: 外部ポータルサイトへの連携機能。
- **Utilities.gs**: 共通関数群 (設定取得、画像処理など)。
- **DummyDataGenerator.gs**: テスト用のダミー回答データ生成機能。

## ⚠️ 注意事項
- 画像を使用する場合、Google Drive上の画像ファイルの共有設定が「リンクを知っている全員」等、閲覧可能な状態になっている必要があります。
- 大量のデータを処理する場合、GASの実行時間制限 (6分) にご注意ください。
